<!-- Header -->
<header class="app-header">
  <div class="header-left">
    <img src="assets/image/logo.png" alt="Logo" class="logo" />
  </div>
</header>


<div class="main-container">
 
  <aside class="task-sidebar">
    <div class="sidebar-header">
      <h3>ğŸ“… Unrated Tasks</h3>
      <p>This Month</p>
    </div>
    
    <div class="sidebar-content">
      <div *ngFor="let dateKey of getSortedDates(); let i = index" 
           class="date-item" 
           (click)="onDateClick(dateKey)"
           [class.active]="selectedTaskForEdit?.date === dateKey">
        <div class="date-header">
          <span class="date">{{ formatDate(dateKey) }}</span>
          <span class="task-count">{{ currentMonthTasks[dateKey].length }} tasks</span>
        </div>
      </div>
      
      <div *ngIf="!hasCurrentMonthTasks()" class="no-tasks">
        âœ… No unrated tasks this month!
      </div>
    </div>
  </aside>

  
  <main class="main-content">

<!-- Employee Details Section -->
<div class="employee-card">
  <div class="employee-row">
    <!-- Employee ID -->
    <div class="employee-field">
      <label for="employeeId">ğŸ·ï¸Employee ID</label>
      <input type="text" id="employeeId" [(ngModel)]="employeeId" placeholder="Employee ID" readonly/>
    </div>

    <!-- Employee Name -->
    <div class="employee-field">
      <label for="employeeName">ğŸ‘¤Employee Name</label>
      <input type="text" id="employeeName" [(ngModel)]="employeeName" placeholder="Employee Name" readonly/>
    </div>
  </div>
</div>


<!-- Task Form -->
<div class="task-form">
  <form [formGroup]="taskForm" (ngSubmit)="saveTask()">

  <div formArrayName="tasks">
    <div *ngFor="let task of tasks.controls; let i = index" [formGroupName]="i" class="task-block">

      <!-- Always Visible: Date (only for the first task) -->
<div class="form-row task-header" *ngIf="i === 0">
  <div class="form-group">
    <label>ğŸ“… Date *</label>
    <input type="date" formControlName="date" />
  </div>
</div>   
        <!-- Project Name -->
<div class="form-row">
  <div class="form-group">
    <label>ğŸ“Š Project Name *</label>
    <select formControlName="project">
      <option value="">- Select -</option>
      <option *ngFor="let project of projects" [value]="project">{{ project }}</option>
    </select>
  </div>


<!-- Team Lead Name -->
  <div class="form-group">
    <label>ğŸ‘¤ Team Lead Name *</label>
    <select formControlName="teamLead">
      <option value="">- Select -</option>
      <option *ngFor="let teamLead of teamLeads" [value]="teamLead">{{ teamLead }}</option>
    </select>
  </div>
</div>

<!-- Arrow placed below project name -->
<div class="arrow-container" (click)="toggleTask(i)">
  <span class="toggle-arrow">{{ expandedTaskIndex === i ? 'â–¼ ' : 'â–¶ ' }}</span>
</div>

        <!-- Collapsible Section -->
      <div *ngIf="expandedTaskIndex === i" class="collapsible-form">
        <!-- Tasks -->
        <div class="form-row">
          <div class="form-group full-width">
            <label>ğŸ“ Tasks *</label>
            <textarea formControlName="taskTitle" class="tasks-box"></textarea>
          </div>
        </div>

        <!-- Description -->
        <div class="form-row">
          <div class="form-group full-width">
            <label>ğŸ“– Description *</label>
            <textarea formControlName="description" class="description-box"></textarea>
          </div>
        </div>

        <!-- File + PR Link in one line -->
<div class="form-row pr-task-inline">
  
  <!-- File -->
  <div class="form-group half-width">
    <label>ğŸ“‚ Task Reference</label>
    <input type="file" (change)="onFileChange($event,i)" />
  </div>

  <!-- PR Link -->
  <div class="form-group half-width">
    <label>ğŸ”— PR Link</label>
    <input 
      type="url" 
      formControlName="prLink" 
      placeholder="https://github.com/org/repo/pull/123" />

    <!-- Status -->
    <small *ngIf="task.get('prLink')?.value; else noPr">
      âœ… <a [href]="task.get('prLink')?.value" target="_blank">View PR</a>
    </small>
    <ng-template #noPr>
      <small>âš ï¸ No PR added yet</small>
    </ng-template>
  </div>

</div>


        <!-- Status + Hours -->
        <div class="form-row">
          <div class="form-group">
            <label>ğŸš© Status *</label>
            <select formControlName="status">
              <option value="">- Select -</option>
              <option value="Complete">Complete âœ…</option>
              <option value="InComplete">Incomplete âŒ</option>
              <option value="Partial">Partial â³</option>
            </select>
          </div>

          <div class="form-group">
            <label>â° Hours *</label>
            <input type="time" formControlName="hours" />
          </div>
        </div>

        <!-- Extra Hours -->
        <div class="form-row">
          <div class="form-group">
            <label>â• Extra Hours</label>
            <input type="time" formControlName="extraHours" />
          </div>
        </div>

        <!-- Remove Button -->
        <div class="form-row">
          <button type="button" class="btn btn-danger" (click)="removeTask(i)" *ngIf="tasks.length > 1">
            âŒ Remove
          </button>
        </div>
      </div> 
    </div>   
  </div>     
  <!-- Actions -->
  <div class="form-actions">
    <button type="button" class="btn btn-secondary" (click)="addTask()">â• Add More Task</button>
    <button type="submit" class="btn btn-primary">ğŸ’¾ Save Task</button>
    <button type="button" class="btn btn-exit" (click)="onExit()">ğŸšª Exit</button>
  </div>

</form>
    </div>
  </main>
</div>

<!-- Edit Popup Modal -->
<div *ngIf="showEditPopup" class="edit-popup-overlay">
  <div class="edit-popup">
    <div class="popup-header">
      <h3>âœï¸ Edit Tasks - {{ selectedTaskForEdit?.date | date:'MMM dd, yyyy' }}</h3>
      <button class="close-btn" (click)="closeEditPopup()">Ã—</button>
    </div>
    
    <div class="popup-content">
      <div *ngFor="let task of selectedTaskForEdit?.tasks; let i = index" class="edit-task-item">
        <h4>Task {{ i + 1 }}</h4>
        
        <div class="form-row">
          <div class="form-group full-width">
            <label>ğŸ“ Task Name</label>
           <input type="text" 
                   [value]="selectedTaskForEdit.tasks[i].taskName || ''"
                   (input)="updateTaskInPopup(i, 'taskName', $event.target.value)" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label>ğŸ“– Description</label>
            <textarea [value]="selectedTaskForEdit.tasks[i].description || ''"
                      (input)="updateTaskInPopup(i, 'description', $event.target.value)"
                      class="description-box"></textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>ğŸš© Status</label>
            <select [value]="selectedTaskForEdit.tasks[i].status || ''"
                    (change)="updateTaskInPopup(i, 'status', $event.target.value)">
              <option value="Complete">Complete âœ…</option>
              <option value="InComplete">Incomplete âŒ</option>
              <option value="Partial">Partial â³</option>
            </select>
          </div>
          <div class="form-group">
            <label>â° Hours</label>
           <input type="time" 
                   [value]="selectedTaskForEdit.tasks[i].hours || ''"
                   (input)="updateTaskInPopup(i, 'hours', $event.target.value)" />
          </div>
          <div class="form-group">
            <label>â• Extra Hours</label>
           <input type="time" 
                   [value]="selectedTaskForEdit.tasks[i].extraHours || ''"
                   (input)="updateTaskInPopup(i, 'extraHours', $event.target.value)" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>ğŸ”— PR Link</label>
            <input type="url" 
                   [value]="selectedTaskForEdit.tasks[i].prLink || ''"
                   (input)="updateTaskInPopup(i, 'prLink', $event.target.value)" />
          </div>
        </div>
      </div>
    </div>

    <div class="popup-actions">
      <button class="btn btn-secondary" (click)="closeEditPopup()">Cancel</button>
      <button class="btn btn-primary" (click)="submitEditedTasks()">ğŸ’¾ Update Tasks</button>
    </div>
  </div>
</div>

<!-- ğŸ”¹ Custom Alert Modal -->
<div *ngIf="showAlert" class="custom-alert-overlay">
  <div class="custom-alert-box">
    <p>{{ alertMessage }}</p>
    <button (click)="closeCustomAlert()">OK</button>
  </div>
</div>

<!-- ğŸ”¹ Custom Confirm Modal -->
<div *ngIf="showConfirm" class="custom-alert-overlay">
  <div class="custom-alert-box">
    <p>{{ confirmMessage }}</p>
    <div class="btn-group">
      <button class="btn-yes" (click)="confirmYes()">Yes</button>
      <button class="btn-no" (click)="confirmNo()">No</button>
    </div>
  </div>
</div>







